# 面试题分享
## 一.csrf的攻击和防范方法
##### csrf攻击：cross site request forgery 跨站请求伪造
- 原理:
	      1.User(C)访问信任网站Web(A)，Web(A)会在User(C)处设置A的cookie；
        2.User(C) 在没有登录A的情况下,访问危险网站Web(B),B网站要求User(C)访问Web(A);
        3.User(C)在Web(B)的要求下，带着Web(A)的cookie访问Web(A)，这样Web(B)就达到了模拟用户操作的目的
- 防御:
        1.通过 referer、token 或者 验证码 来检测用户提交。
        2.尽量不要在页面的链接中暴露用户隐私信息。
        3.对于用户修改删除等操作最好都使用post操作 。
        4.避免全站通用的cookie，严格设置cookie的域。
> 1.cookie的域: 用domain来表示cookie所在的域，默认为请求的地址，如网址为www.baidu.com/test/test.aspx，那么domain默认为www.baidu.com.
  2.跨域访问: 如域A为t1.test.com，域B为t2.test.com，域B生产一个令域A和域B都能访问的cookie就会将该cookie的domain设置为.test.com


## 二.https的交互过程
##### HTTPS其实是有两部分组成：HTTP + SSL / TLS，也就是在HTTP上又加了一层处理加密信息的模块。服务端和客户端的信息传输都会被加密，所以传输的数据都是加密后的数据。

- https的主要交互过程:
客户端发起HTTPS请求 → 服务端返回证书 → 客户端验证证书并响应 → 服务端解析和验证 → 客户端解析和验证

##### 1.1 客户端发起HTTPS请求

     比如在浏览器里输入https://blog.csdn.net/yjclsx，然后请求到server的443端口。浏览器会把自身支持的一系列Cipher Suite（密钥算法套件，简称Cipher）发送给服务端。

##### 1.2服务端返回证书

     服务端接收到客户端所有的Cipher后与自身支持的对比，如果不支持则连接断开，反之则会从中选出一种加密算法和HASH算法以证书的形式返回给客户端，证书中还包含了公钥、颁证机构、网址、失效日期等等。
     注：采用HTTPS协议的服务器必须要有一套数字证书，可以自己制作，也可以向组织申请。区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面。这套证书其实就是一对公钥和私钥，用于非对称加密。

##### 1.3客户端验证证书并响应

客户端收到服务端响应后会做以下几件事：
- 1.3.1 验证证书的合法性(CA认证)
颁发证书的机构是否合法与是否过期，证书中包含的网站地址是否与正在访问的地址一致等。证书验证通过后，在浏览器的地址栏提示网站安全。
- 1.3.2 生成随机密码
如果证书验证通过，或者用户接受了授信的证书，此时客户端会生成一串随机数，用于后续进行对称加密，以后称之为密钥，然后用证书中的公钥加密这个密钥。
- 1.3.3 HASH握手信息
用最开始约定好的HASH方式，把握手消息取HASH值，然后用密钥加密 “握手消息+握手消息的HASH值(即签名)”。在这里之所以要加上握手消息的HASH值，主要是把握手消息做一个签名，用于验证握手消息在传输过程中没有被篡改过。
最后将之前生成的所有信息发送给服务端。

##### 1.4服务端解析和验证

服务端接收客户端发来的数据之后要做以下的操作：

- 1.4.1 解析和验证并返回
使用自己的私钥将客户端使用公钥加密的信息解密得到之前客户端生成的密钥。然后使用密钥解密客户端发来的加密后的握手消息得到 “握手消息+握手消息的HASH值(即签名)”，最后同样对握手信息进行HASH签名，比对和客户端传来的HASH值是否一致，如果一致则HASH验证通过，即表明握手消息在传输过程中没有被篡改过。同样使用密钥加密一段握手消息，发送给客户端。

##### 1.5客户端解析和验证

     客户端用密钥解密并计算握手消息的HASH，如果与服务端发来的HASH一致，此时握手过程结束,至此https整个交互完成。

## 三.如何生成共享秘钥？ 如何防范中间人攻击？
    密钥的生成是通过使用全局配置命令完成的：
        对于不可输出密钥是<crypto key generate rsa label {label string}>,而对于可输出密钥则是<crypto key generate rsa exportable label {label string}>.标记（label）是可选择的；如果没有指定标记，那么密钥名称将是hostname.domain-name。
对于中间人的攻击，可以采用如下防范手段：
- 通过采用动态ARP检测、DHCP Snooping等控制操作来加强网络基础设施
- 采用传输加密
- 使用CASBs（云访问安全代理）
- 创建RASP（实时应用程序自我保护）
- 阻止自签名证书
- 强制使用SSL pinning
- 安装DAM（数据库活动监控）

> 题目链接
https://blog.csdn.net/enohtzvqijxo00atz3y8/article/details/82881250
https://www.cnblogs.com/zhangshitong/p/6478721.html
